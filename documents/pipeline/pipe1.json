[
 {
  "application": "eng",
  "id": "228f5322-0f16-4710-9954-6705b9118b8f",
  "index": 0,
  "keepWaitingPipelines": false,
  "lastModifiedBy": "anonymous",
  "limitConcurrent": true,
  "name": "deploy",
  "stages": [
   {
    "account": "default",
    "cloudProvider": "kubernetes",
    "manifestArtifactAccount": "embedded-artifact",
    "manifests": [
     {
      "apiVersion": "apps/v1",
      "kind": "Deployment",
      "metadata": {
       "labels": {
        "app": "eng-app-app",
        "version": "v1"
       },
       "name": "eng-app-app",
       "namespace": "eng-app"
      },
      "spec": {
       "replicas": 1,
       "selector": {
        "matchLabels": {
         "app": "eng-app-app"
        }
       },
       "template": {
        "metadata": {
         "labels": {
          "app": "eng-app-app",
          "version": "v1"
         }
        },
        "spec": {
         "containers": [
          {
           "command": [
            "/bin/sh",
            "-c",
            "cd /english_study_app/eng_app/public/; rm -r voice ; ln -s /mnt/voice/ voice; cd /english_study_app/eng_app/ ; rails s -b=0.0.0.0"
           ],
           "envFrom": [
            {
             "secretRef": {
              "name": "eng-app-secret"
             }
            }
           ],
           "image": "docker.io/miyakz1192/eng_app:1",
           "name": "eng-app-app",
           "ports": [
            {
             "containerPort": 3000
            }
           ],
           "volumeMounts": [
            {
             "mountPath": "/mnt",
             "name": "eng-app-data"
            }
           ]
          }
         ],
         "volumes": [
          {
           "name": "eng-app-data",
           "persistentVolumeClaim": {
            "claimName": "eng-app-data-pvc"
           }
          }
         ]
        }
       }
      }
     },
     {
      "apiVersion": "v1",
      "kind": "Service",
      "metadata": {
       "labels": {
        "app": "eng-app-app"
       },
       "name": "eng-app-app-service",
       "namespace": "eng-app"
      },
      "spec": {
       "ports": [
        {
         "name": "http",
         "port": 3000
        }
       ],
       "selector": {
        "app": "eng-app-app"
       }
      }
     },
     {
      "apiVersion": "apps/v1",
      "kind": "Deployment",
      "metadata": {
       "labels": {
        "app": "eng-app-mysql",
        "version": "v1"
       },
       "name": "eng-app-mysql",
       "namespace": "eng-app"
      },
      "spec": {
       "replicas": 1,
       "selector": {
        "matchLabels": {
         "app": "eng-app-mysql"
        }
       },
       "template": {
        "metadata": {
         "labels": {
          "app": "eng-app-mysql",
          "version": "v1"
         }
        },
        "spec": {
         "containers": [
          {
           "envFrom": [
            {
             "secretRef": {
              "name": "eng-app-secret"
             }
            }
           ],
           "image": "docker.io/mysql:5.7.29",
           "name": "eng-app-mysql",
           "ports": [
            {
             "containerPort": 3306
            }
           ],
           "volumeMounts": [
            {
             "mountPath": "/var/lib/mysql",
             "name": "eng-app-pv"
            }
           ]
          }
         ],
         "volumes": [
          {
           "name": "eng-app-pv",
           "persistentVolumeClaim": {
            "claimName": "eng-app-pvc"
           }
          }
         ]
        }
       }
      }
     },
     {
      "apiVersion": "v1",
      "kind": "Service",
      "metadata": {
       "labels": {
        "app": "eng-app-mysql"
       },
       "name": "eng-app-mysql-service",
       "namespace": "eng-app"
      },
      "spec": {
       "ports": [
        {
         "name": "http",
         "port": 3306
        }
       ],
       "selector": {
        "app": "eng-app-mysql"
       }
      }
     },
     {
      "apiVersion": "networking.istio.io/v1alpha3",
      "kind": "DestinationRule",
      "metadata": {
       "name": "eng-app-destination-rules",
       "namespace": "eng-app"
      },
      "spec": {
       "host": "eng-app-app",
       "subsets": [
        {
         "labels": {
          "version": "v1"
         },
         "name": "v1"
        }
       ],
       "trafficPolicy": {
        "tls": {
         "mode": "ISTIO_MUTUAL"
        }
       }
      }
     },
     {
      "apiVersion": "networking.istio.io/v1alpha3",
      "kind": "Gateway",
      "metadata": {
       "name": "eng-app-gateway",
       "namespace": "eng-app"
      },
      "spec": {
       "selector": {
        "istio": "ingressgateway"
       },
       "servers": [
        {
         "hosts": [
          "*"
         ],
         "port": {
          "name": "http",
          "number": 80,
          "protocol": "HTTP"
         }
        }
       ]
      }
     },
     {
      "apiVersion": "networking.istio.io/v1alpha3",
      "kind": "VirtualService",
      "metadata": {
       "name": "eng-app-virtual-service",
       "namespace": "eng-app"
      },
      "spec": {
       "gateways": [
        "eng-app-gateway"
       ],
       "hosts": [
        "*"
       ],
       "http": [
        {
         "route": [
          {
           "destination": {
            "host": "eng-app-app-service",
            "port": {
             "number": 3000
            }
           }
          }
         ]
        }
       ]
      }
     }
    ],
    "moniker": {
     "app": "eng"
    },
    "name": "Deploy (Manifest)",
    "refId": "1",
    "relationships": {
     "loadBalancers": [],
     "securityGroups": []
    },
    "requisiteStageRefIds": [],
    "source": "text",
    "type": "deployManifest"
   }
  ],
  "triggers": [],
  "updateTs": "1584707600000"
 },
 {
  "application": "eng",
  "disabled": true,
  "id": "dea02d51-0cc8-443c-864e-ee5b0adb6475",
  "index": 1,
  "keepWaitingPipelines": false,
  "lastModifiedBy": "anonymous",
  "limitConcurrent": true,
  "name": "delete(eng-app ok)",
  "stages": [
   {
    "account": "default",
    "app": "eng",
    "cloudProvider": "kubernetes",
    "location": "eng-app",
    "manifestName": "deployment eng-app-app",
    "mode": "static",
    "name": "deleteold",
    "options": {
     "cascading": true
    },
    "refId": "3",
    "requisiteStageRefIds": [],
    "type": "deleteManifest"
   }
  ],
  "triggers": [],
  "updateTs": "1584379209000"
 },
 {
  "application": "eng",
  "disabled": true,
  "id": "a6bd6cea-51cc-49ee-8662-e276cdf96d33",
  "index": 2,
  "keepWaitingPipelines": false,
  "lastModifiedBy": "anonymous",
  "limitConcurrent": true,
  "name": "delete",
  "stages": [],
  "triggers": [],
  "updateTs": "1584379184000"
 },
 {
  "application": "eng",
  "id": "eb0ba344-3f58-479b-be15-bbe0b780aaa7",
  "index": 3,
  "keepWaitingPipelines": false,
  "lastModifiedBy": "anonymous",
  "limitConcurrent": true,
  "name": "del(exact)",
  "stages": [
   {
    "account": "default",
    "app": "eng",
    "cloudProvider": "kubernetes",
    "kinds": [
     "deployment"
    ],
    "labelSelectors": {
     "selectors": [
      {
       "key": "app",
       "kind": "EXISTS",
       "values": [
        "eng-app"
       ]
      }
     ]
    },
    "location": "eng-app",
    "mode": "label",
    "name": "Delete (Manifest)",
    "options": {
     "cascading": true
    },
    "refId": "1",
    "requisiteStageRefIds": [],
    "type": "deleteManifest"
   }
  ],
  "triggers": [],
  "updateTs": "1584378377000"
 },
 {
  "application": "eng",
  "id": "1bcc35ee-cdb6-4d98-a75b-6b53510a1210",
  "index": 4,
  "keepWaitingPipelines": false,
  "lastModifiedBy": "anonymous",
  "limitConcurrent": true,
  "name": "re-deploy",
  "stages": [
   {
    "account": "default",
    "app": "eng",
    "cloudProvider": "kubernetes",
    "kinds": [
     "deployment"
    ],
    "labelSelectors": {
     "selectors": [
      {
       "key": "app",
       "kind": "EXISTS",
       "values": [
        "eng-app"
       ]
      }
     ]
    },
    "location": "eng-app",
    "mode": "label",
    "name": "Delete (Manifest)",
    "options": {
     "cascading": true
    },
    "refId": "3",
    "requisiteStageRefIds": [],
    "type": "deleteManifest"
   },
   {
    "account": "default",
    "cloudProvider": "kubernetes",
    "manifestArtifactAccount": "embedded-artifact",
    "manifests": [
     {
      "apiVersion": "apps/v1",
      "kind": "Deployment",
      "metadata": {
       "labels": {
        "app": "eng-app-app",
        "version": "v1"
       },
       "name": "eng-app-app",
       "namespace": "eng-app"
      },
      "spec": {
       "replicas": 1,
       "selector": {
        "matchLabels": {
         "app": "eng-app-app"
        }
       },
       "template": {
        "metadata": {
         "labels": {
          "app": "eng-app-app",
          "version": "v1"
         }
        },
        "spec": {
         "containers": [
          {
           "command": [
            "/bin/sh",
            "-c",
            "cd /english_study_app/eng_app/public/; rm -r voice ; ln -s /mnt/voice/ voice; cd /english_study_app/eng_app/ ; rails s -b=0.0.0.0"
           ],
           "envFrom": [
            {
             "secretRef": {
              "name": "eng-app-secret"
             }
            }
           ],
           "image": "docker.io/miyakz1192/eng_app:1",
           "name": "eng-app-app",
           "ports": [
            {
             "containerPort": 3000
            }
           ],
           "volumeMounts": [
            {
             "mountPath": "/mnt",
             "name": "eng-app-data"
            }
           ]
          }
         ],
         "volumes": [
          {
           "name": "eng-app-data",
           "persistentVolumeClaim": {
            "claimName": "eng-app-data-pvc"
           }
          }
         ]
        }
       }
      }
     },
     {
      "apiVersion": "v1",
      "kind": "Service",
      "metadata": {
       "labels": {
        "app": "eng-app-app"
       },
       "name": "eng-app-app-service",
       "namespace": "eng-app"
      },
      "spec": {
       "ports": [
        {
         "name": "http",
         "port": 3000
        }
       ],
       "selector": {
        "app": "eng-app-app"
       }
      }
     },
     {
      "apiVersion": "apps/v1",
      "kind": "Deployment",
      "metadata": {
       "labels": {
        "app": "eng-app-mysql",
        "version": "v1"
       },
       "name": "eng-app-mysql",
       "namespace": "eng-app"
      },
      "spec": {
       "replicas": 1,
       "selector": {
        "matchLabels": {
         "app": "eng-app-mysql"
        }
       },
       "template": {
        "metadata": {
         "labels": {
          "app": "eng-app-mysql",
          "version": "v1"
         }
        },
        "spec": {
         "containers": [
          {
           "envFrom": [
            {
             "secretRef": {
              "name": "eng-app-secret"
             }
            }
           ],
           "image": "docker.io/mysql:5.7.29",
           "name": "eng-app-mysql",
           "ports": [
            {
             "containerPort": 3306
            }
           ],
           "volumeMounts": [
            {
             "mountPath": "/var/lib/mysql",
             "name": "eng-app-pv"
            }
           ]
          }
         ],
         "volumes": [
          {
           "name": "eng-app-pv",
           "persistentVolumeClaim": {
            "claimName": "eng-app-pvc"
           }
          }
         ]
        }
       }
      }
     },
     {
      "apiVersion": "v1",
      "kind": "Service",
      "metadata": {
       "labels": {
        "app": "eng-app-mysql"
       },
       "name": "eng-app-mysql-service",
       "namespace": "eng-app"
      },
      "spec": {
       "ports": [
        {
         "name": "http",
         "port": 3306
        }
       ],
       "selector": {
        "app": "eng-app-mysql"
       }
      }
     },
     {
      "apiVersion": "networking.istio.io/v1alpha3",
      "kind": "DestinationRule",
      "metadata": {
       "name": "eng-app-destination-rules",
       "namespace": "eng-app"
      },
      "spec": {
       "host": "eng-app-app",
       "subsets": [
        {
         "labels": {
          "version": "v1"
         },
         "name": "v1"
        }
       ],
       "trafficPolicy": {
        "tls": {
         "mode": "ISTIO_MUTUAL"
        }
       }
      }
     },
     {
      "apiVersion": "networking.istio.io/v1alpha3",
      "kind": "Gateway",
      "metadata": {
       "name": "eng-app-gateway",
       "namespace": "eng-app"
      },
      "spec": {
       "selector": {
        "istio": "ingressgateway"
       },
       "servers": [
        {
         "hosts": [
          "*"
         ],
         "port": {
          "name": "http",
          "number": 80,
          "protocol": "HTTP"
         }
        }
       ]
      }
     },
     {
      "apiVersion": "networking.istio.io/v1alpha3",
      "kind": "VirtualService",
      "metadata": {
       "name": "eng-app-virtual-service",
       "namespace": "eng-app"
      },
      "spec": {
       "gateways": [
        "eng-app-gateway"
       ],
       "hosts": [
        "*"
       ],
       "http": [
        {
         "route": [
          {
           "destination": {
            "host": "eng-app-app-service",
            "port": {
             "number": 3000
            }
           }
          }
         ]
        }
       ]
      }
     }
    ],
    "moniker": {
     "app": "eng"
    },
    "name": "Deploy (Manifest)",
    "refId": "4",
    "relationships": {
     "loadBalancers": [],
     "securityGroups": []
    },
    "requisiteStageRefIds": [
     "3"
    ],
    "source": "text",
    "type": "deployManifest"
   }
  ],
  "triggers": [
   {
    "account": "dockerhub",
    "enabled": true,
    "organization": "miyakz1192",
    "registry": "index.docker.io",
    "repository": "miyakz1192/eng_app",
    "tag": "",
    "type": "docker"
   }
  ],
  "updateTs": "1584714823000"
 }
]
