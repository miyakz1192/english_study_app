==========================================================
どんなアプリ？
==========================================================

DUO 3.0の学習速度アップのために以下の機能を持つweb appを作って
自分だけ利用できるようにする。

もし、DUO 3.0のデータをこのアプリ指定のフォーマットで作って
配置すれば、他の人でもアプリを利用できるようにする。

狭い電車の車内でも学習しやすく、長く学習できそうなゆるい感じを目指す。

機能
====

以下の機能を備える。

0) ログイン・ログアウト機能(DONE)
　登録したユーザだけ、できるようにする。
　ユーザ登録はローカルのCLIで行えるようにする（基本的には個人ユースの設計)

1) 点数管理機能(DONE)
  どの英文がＮＧだったかを出力する。点数がつく。
  「英文を書かずに学習」でOKなものは1点加点。
  「英文を書かずに学習」でNGなものは1点減点。
  「英文を書いて学習」でOKなものは2点加点。
  「英文を書いて学習」でNGなものは2点減点。

  //２回め以上の点数について
  //「英文を書かずに学習」加点と減点にそれぞれ、係数が加算される(1.01*トライ回数) 
  //「英文を書いて学習」加点と減点にそれぞれ、係数が加算される(1.02*トライ回数) 
  // →　めんどくさいので実装しない(気が向けば実装)。

  要するに、OKなものは学習優先度を低く、間違ったものは学習優先度が高くする。
  とくに書いて学習したもので、ＯＫなものは繰り返しやらなくても良いようにして、
  何回も間違えるものについては、優先度高く学習するような感じにする。

2) ダッシュボード機能(DONE)
　どの文章の覚えが良いのか、top5を表示
　どの文章の覚えが悪いのか、ワースト5を表示
  達成率を表示
  　点数が１点以上の文章/全文章数のパーセンテージ
  　文章を書いて学習が１回以上があり、点数が2点以上の文章/全文章数のパーセンテージ
  　文章を書かずに学習が１回以上があり、点数が1点以上の文章/全文章数のパーセンテージ


3) リスト機能(DONE)
　すべての英文の日本語が出力される(点数関係なく、文章番号で出る)。
　選択したものから、以下、カード機能がスタートする。

4) チャレンジリスト機能(DONE)
　すべての英文の日本語が出力される(点数が低い順に出る)。
　選択したものから、以下、カード機能がスタートする。

5) カード機能(DONE)
　１本１本、単語帳のように画面に出力。まずは日本語が出る。
　その下に、「英文を書かずに学習」ボタンと「英文を書いて学習」ボタンがある。
　
  「英文を書かずに学習」ボタンを押すと、日本語の下の英文がでる。
  スピーカーボタンを押すと、英文読み上げ。
  その下にOK,NGボタンがでて、どれかを押すと、次の文章に進む


  「英文を書いて学習」ボタンを押すと
  エディットボックスが出現する。そこに英文を入力して、チャレンジボタンを押すと
  英文が出力され、正解したかどうか、間違っていたらどこが間違っていたかを出力する。
  スピーカーボタンを押すと、英文読み上げ。
  OKボタンを押せば、次に進む。

6) セキュリティ強化
　不正アクセスをbanする機能か、
  https://qiita.com/kikunantoka/items/acd9194080edc902c79c
　クライアント認証で認証するか
  https://qiita.com/jiggaman0412/items/74dd0c28b0d7512823d0
  https://qiita.com/ysomei/items/cb89f1c458e6da876d6c
  https://www.webtech.co.jp/blog/optpix_labs/server/1780/
  deviseでFailureAppを使うか
  http://nekorails.hatenablog.com/entry/2018/10/27/172832

  クライアント認証：
  　長所：超強力完璧
    短所：railsの標準にはクライアント認証機能が無く、別途nginxとかを持ち出す必要がある。
    　　　クライアントに証明書を入れる必要がある（どの端末からもアクセスできるわけではない）
          知り合いにさくっと見せたい時に困る。

  不正アクセス元のIPアドレスをban：
  　長所：これも良い
  　短所：どこからでも不正アクセスを喰らう
  　　　　DDos攻撃をウケる可能性もある。
  　　　　実装方法がよくわからない(FailureAppを使える可能性がある)。

  アクセス失敗したユーザを凍結
  　長所：Deviseで簡単にできる
  　短所：攻撃者が正当利用者のアカウントを凍結させられる
  　備考：果たして、攻撃者が正当利用者のアカウントを想像できるのか？

画面デザイン
=============

最初にダッシュボードが出力されて、リスト、チャレンジリストボタンがあって、
それを押すと学習がスタートする。

多分、ダッシュボードの画面が改善が入りやすいので、それとそれ以外を
サービスに分けるのが良さそうな感じ。

データ構造(モデル)
===================

ユーザ(ユーザ名、パスワード) 。なお、パスワードはsha256のハッシュ値

センテンス（英語、日本語、音声データ)

成績データ(base)
         (学習日、正解かどうか、センテンスへのリンク、ユーザへのリンク)

成績データ（英語を書かずに学習) extends 成績データ(base)
成績データ（英語を書いて学習) extends 成績データ(base)

セキュリティ仕様
======================

検討する仕様

不正アクセス時のログをsyslogに出力する。
そのログをcronのscriptで拾ってiptablesでIPをbanする。

ログの出力条件は以下。
　同一IPアドレスで、x時間以内にy回認証に失敗した場合。
  (x,yはconfiurable)

運用
　banを解除する場合は単純にiptablesを削除(そんなに発生しない想定)。
　ログを消し去る場合は、DBを操作(そんなに発生しない想定)。

